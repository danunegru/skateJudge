<div class="event-details-container" *ngIf="eventDetails">
  <div class="event-header">
    <h2>{{ eventDetails.name }}</h2>
    <div class="button-group">
      <button class="add-pruefling-button" (click)="addPruefling()">
        <mat-icon>add</mat-icon>
        Prüfling hinzufügen
      </button>
      <button class="back-button" (click)="goBack()">Zurück</button>
    </div>
  </div>

  <div class="event-info">
    <p>Veranstalter: {{ eventDetails.veranstalter }}</p>
    <p>Ort: {{ eventDetails.place }}</p>
    <p>Datum: {{ eventDetails.startDate | date:'dd.MM.yyyy' }} - {{ eventDetails.endDate | date:'dd.MM.yyyy' }}</p>
  </div>

  <div class="pruefling-info">
    <mat-icon>group</mat-icon>
    <span>{{ getUniquePrueflingeCount() }} Prüflinge</span>
  </div>

  <div class="exam-section" *ngIf="selectedExams.length > 0">
    <h3>Ausgewählte Prüfungen</h3>
    <div class="exam-grid">
      <mat-accordion>
        <mat-expansion-panel *ngFor="let exam of selectedExams">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="exam-header">
                <mat-icon>school</mat-icon>
                <a [routerLink]="['/exam', eventDetails.id, exam.id.toLowerCase()]">
                  {{ exam.name }} ({{ exam.id }})
                </a>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <!-- Prüflinge List -->
          <div class="pruefling-list">
            <div *ngIf="getPrueflingeForExam(exam).length === 0" class="no-prueflinge">
              Keine Prüflinge für diese Prüfung
            </div>
            
            <!-- Enhanced athlete list with management features -->
            <div *ngIf="getPrueflingeForExam(exam).length > 0" class="athlete-management-list">
              <div *ngFor="let pruefling of getPrueflingeForExam(exam); let i = index" 
                   class="athlete-item"
                   [class.editing]="editingAthleteId === pruefling.id"
                   [class.hidden]="pruefling.hidden === true">
                
                <!-- Main athlete content - removed all swipe events -->
                <div class="athlete-content">
                  
                  <mat-icon class="athlete-icon">person</mat-icon>
                  
                  <!-- Editable name section -->
                  <div class="athlete-info" *ngIf="editingAthleteId !== pruefling.id">
                    <div class="athlete-name" (click)="startEditing(pruefling)">
                      {{ pruefling.vorname }} {{ pruefling.nachname }}
                      <mat-icon class="edit-icon">edit</mat-icon>
                      <mat-icon class="hidden-icon" *ngIf="pruefling.hidden === true" 
                                [attr.title]="'Dieser Athlet ist ausgeblendet'">
                        visibility_off
                      </mat-icon>
                    </div>
                    <div class="athlete-verein">{{ pruefling.verein }}</div>
                  </div>

                  <!-- Edit mode -->
                  <div class="athlete-edit" *ngIf="editingAthleteId === pruefling.id">
                    <div class="edit-form">
                      <mat-form-field appearance="outline" class="name-field">
                        <mat-label>Vorname</mat-label>
                        <input matInput [(ngModel)]="editForm.vorname" (keyup.enter)="saveEdit(pruefling)">
                      </mat-form-field>
                      
                      <mat-form-field appearance="outline" class="name-field">
                        <mat-label>Nachname</mat-label>
                        <input matInput [(ngModel)]="editForm.nachname" (keyup.enter)="saveEdit(pruefling)">
                      </mat-form-field>
                      
                      <mat-form-field appearance="outline" class="verein-field">
                        <mat-label>Verein</mat-label>
                        <input matInput [(ngModel)]="editForm.verein" (keyup.enter)="saveEdit(pruefling)">
                      </mat-form-field>
                    </div>
                    
                    <div class="edit-actions">
                      <button mat-icon-button color="primary" (click)="saveEdit(pruefling)" [disabled]="!isEditFormValid()">
                        <mat-icon>check</mat-icon>
                      </button>
                      <button mat-icon-button (click)="cancelEdit()">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                  </div>

                  <!-- Exam badges with action buttons -->
                  <div class="athlete-exams">
                    <span class="exam-badge" *ngFor="let examRef of pruefling.exam">
                      {{ examRef.id }}
                    </span>
                    
                    <!-- Action buttons with text labels -->
                    <div class="action-buttons">
                      <button mat-icon-button 
                              [color]="pruefling.hidden === true ? 'primary' : 'warn'"
                              (click)="toggleAthleteVisibility(pruefling)"
                              class="action-btn"
                              [matTooltip]="pruefling.hidden === true ? 'ANZEIGEN' : 'AUSBLENDEN'">
                        <mat-icon>{{ pruefling.hidden === true ? 'visibility' : 'visibility_off' }}</mat-icon>
                      </button>
                      
                      <button mat-icon-button 
                              color="warn"
                              (click)="deleteAthlete(pruefling, exam)"
                              class="action-btn"
                              matTooltip="LÖSCHEN">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Add Prüfling Button for this specific exam -->
            <div class="exam-add-button">
              <button mat-raised-button color="primary" (click)="addPrueflingToExam(exam)">
                <mat-icon>person_add</mat-icon>
                Neue Prüfling hinzufügen
              </button>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>